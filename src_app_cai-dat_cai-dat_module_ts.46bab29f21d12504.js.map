{"version":3,"file":"src_app_cai-dat_cai-dat_module_ts.46bab29f21d12504.js","mappings":"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","sources":["./src/app/cai-dat/cai-dat-routing.module.ts","./src/app/cai-dat/cai-dat.module.ts","./src/app/cai-dat/cai-dat.page.ts","./src/app/service/syncDeta/sync.service.ts","./src/app/cai-dat/cai-dat.page.scss"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { CaiDatPage } from './cai-dat.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: CaiDatPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class CaiDatPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { CaiDatPageRoutingModule } from './cai-dat-routing.module';\r\n\r\nimport { CaiDatPage } from './cai-dat.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    CaiDatPageRoutingModule\r\n  ],\r\n  declarations: [CaiDatPage]\r\n})\r\nexport class CaiDatPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { CAIDAT } from '../service/CAIDAT';\r\n\r\nimport { ToastService } from '../service/toast-service.service';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { SyncService } from '../service/syncDeta/sync.service';\r\nimport { modelDetaServer } from '../service/syncDeta/syncData.model';\r\n\r\n@Component({\r\n  selector: 'app-cai-dat',\r\n  templateUrl: './cai-dat.page.html',\r\n  styleUrls: ['./cai-dat.page.scss'],\r\n})\r\nexport class CaiDatPage {\r\n  openLicense = false\r\n  githubtoken: string = ''\r\n  // serverValid: boolean = false\r\n  constructor(\r\n    private toastController: ToastService,\r\n    public modalController: ModalController,\r\n    public syncService: SyncService,\r\n    \r\n  ) {\r\n    \r\n    this.init()\r\n  }\r\n\r\n  async init(\r\n  ) {\r\n  }\r\n  \r\n  change_DataSync(){\r\n    this.syncService.saveToStorage()\r\n    // console.log(\"linkChanged\")\r\n  }\r\n  \r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Storage } from '@ionic/storage-angular';\r\nimport { CAIDAT } from '../CAIDAT';\r\nimport { ToastService } from '../toast-service.service';\r\nimport { modelSyncData } from './syncData.model';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { HosoService } from '../hoso.service';\r\nimport { HOSO } from '../hoso.model';\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class SyncService {\r\n  public syncData: modelSyncData = {\r\n    detaServer: {},\r\n  };\r\n  public serverValid: boolean = false;\r\n  public serverValidInfo: string = CAIDAT.sync.infoLoiServer;\r\n  public syncInProgress: boolean = false;\r\n  private _storage: Storage | null = null;\r\n  private serverSyncHoSo: HOSO[] = [];\r\n  private serverSyncHoSo_Keys: string[] = [];\r\n  constructor(\r\n    private storage: Storage,\r\n    private toastController: ToastService,\r\n    private httpClient: HttpClient,\r\n    private hosoService: HosoService\r\n  ) {\r\n    this.init();\r\n  }\r\n  async init() {\r\n    const storage = await this.storage.create();\r\n    this._storage = storage;\r\n    // Get link and secretkey of local\r\n    await this._storage.get(CAIDAT.sync.syncKeyStorage).then((re) => {\r\n      if (re) {\r\n        this.syncData = re;\r\n      } else {\r\n        this.saveToStorage();\r\n      }\r\n    });\r\n\r\n    // check server valid\r\n    this.isServerValid();\r\n  }\r\n  async saveToStorage() {\r\n    if (this.syncData.detaServer.link == '') {\r\n      this.syncData.detaServer.link = 'https://deta.space';\r\n    }\r\n    await this.toastController.presentToast({\r\n      message: 'Đã lưu cài đặt',\r\n      color: 'danger',\r\n    });\r\n    this._storage?.set(CAIDAT.sync.syncKeyStorage, this.syncData);\r\n    // check valid\r\n    this.isServerValid();\r\n  }\r\n\r\n  // This code assumes the existence of a function to post data to the server and a model for the server response.\r\n  // You will need to replace `postToServer` with your actual HTTP POST function,\r\n  // and `ServerResponse` with the actual response type you expect from the server.\r\n\r\n  async isServerValid(): Promise<boolean> {\r\n    try {\r\n      const response = await this.postToServer(\r\n        this.syncData.detaServer.link + 'api/test',\r\n        this.syncData.detaServer\r\n      );\r\n      // Replace 'ServerResponse' with the actual response type and 'message' with the actual success field\r\n      // console.log(response)\r\n      if (response.m === true) {\r\n        this.serverValid = true;\r\n        this.serverValidInfo = CAIDAT.sync.infoKetNoiServer;\r\n        return true;\r\n      }\r\n      this.serverValid = false;\r\n      this.serverValidInfo = CAIDAT.sync.infoLoiServer;\r\n\r\n      return false;\r\n    } catch (error) {\r\n      console.error('Lỗi dữ liệu với server:', error);\r\n      this.serverValid = false;\r\n      this.serverValidInfo = CAIDAT.sync.infoLoiServer;\r\n      return false;\r\n    }\r\n  }\r\n  private async postToServer(url: string, payload: any): Promise<any> {\r\n    // Implement the logic to post data to the server.\r\n    // This is a placeholder example using the Angular HttpClient.\r\n    // You'll need to replace this with your actual HTTP client code.\r\n\r\n    try {\r\n      const response = await this.httpClient.post(url, payload).toPromise();\r\n      return response;\r\n    } catch (error) {\r\n      // console.error('Lỗi dữ liệu với server:', error);\r\n      throw error;\r\n    }\r\n  }\r\n  async startSync(): Promise<any> {\r\n    this.syncInProgress = true;\r\n    /* \r\n    1. Check server valid\r\n     */\r\n    if (!this.serverValid) {\r\n      this.serverValidInfo = CAIDAT.sync.infoLoiServer;\r\n      return false;\r\n    }\r\n    /* 2. Get hoso this.hosoService.danhsachhoso và hồ sơ online\r\n     */\r\n    // hồ sơ online\r\n    await this.getAllPackages('open');\r\n\r\n    /*\r\n    TODO: Local có Hoso + mà Server - không có\r\n    TODO: Local Hoso + và Server đều có +\r\n    3. check if have detaKey\r\n    if not have -> send to server\r\n    if have -> check valid day */\r\n    for (const hoso of this.hosoService.danhsachhoso) {\r\n      /* if hoso not have key -> send to server\r\n        if have -> check time hoso.sync.lastSync\r\n        TODO: Local có Hoso mà Server không có\r\n      */\r\n      // console.log(hoso.key)\r\n      /*  1. If hoso.key is an empty string ''\r\n          2. If hoso.key is undefined\r\n          3. If the value of hoso.key is not included in the array this.serverSyncHoSo_Keys \r\n          -> Insert to Server\r\n          */\r\n      if (\r\n        hoso.key == '' ||\r\n        hoso.key == undefined ||\r\n        !this.serverSyncHoSo_Keys.includes(hoso.key)\r\n      ) {\r\n        // send to server and @Update local\r\n        let newHoSo = await this.insertHosoToServer(hoso);\r\n        // get respond and save to local\r\n        // console.log(newHoSo)\r\n        // await this.hosoService.updateHoSo(newHoSo, CAIDAT.hoso.saveFromSyncServer)\r\n      } else {\r\n        /* TODO: Local Hoso và Server đều có */\r\n        console.info('hoso hiện tại Có key và server cũng có key');\r\n        // hoso hiện tại Có key và server cũng có key\r\n        // kiểm tra 2 ngày của hoso và this.serverSyncHoSo. Nếu hoso lớn hơn thì upload. Nếu server lớn hơn thì download\r\n        const hosoFromServer = this.serverSyncHoSo.filter(\r\n          (item) => item.key === hoso.key\r\n        );\r\n        // console.log(selectedItems)\r\n        if (hosoFromServer.length > 0) {\r\n          //@ts-ignore\r\n          if (hosoFromServer[0].sync.lastSync < hoso.sync.lastSync) {\r\n            /* Nếu trên server nhỏ hơn thì upload\r\n              1. Đây là trường hợp đổi máy: \r\n                ĐT sửa và upload rồi\r\n                  qua máy tính: chưa có - tải về;\r\n                  có rồi -> \r\n               */\r\n            // let newHoSo = await this.updateHosoToServer(hoso);\r\n            // get respond and save to local\r\n            // await this.hosoService.updateHoSo(newHoSo, CAIDAT.hoso.saveFromSyncServer)\r\n            // @ts-ignore\r\n            let respd =await this.postToServer(\r\n              this.syncData.detaServer.link + 'api/hoso/put',\r\n              hoso\r\n            )\r\n            // @ts-ignore\r\n            console.log(respd, hosoFromServer[0].sync.lastSync);\r\n          }\r\n          //@ts-ignore\r\n          else if (hosoFromServer[0].sync.lastSync > hoso.sync.lastSync){\r\n            /* Nếu server lớn hơn thì download */\r\n            // this.hosoService.\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /* TODO: Local Hoso - không có và Server có + */\r\n    // Test: Xóa trong LocalStorage, sync về\r\n    let hosoFromServerCoMaLocalKhong = this.serverSyncHoSo.filter(\r\n      (serverHoso) =>\r\n        !this.hosoService.danhsachhoso.some(\r\n          (localHoso) => localHoso.key === serverHoso.key\r\n        )\r\n    );\r\n    /* Loop và download */\r\n    for (const hoso of hosoFromServerCoMaLocalKhong) {\r\n      await this.hosoService.addNewHoSo(hoso)\r\n    }\r\n    this.syncInProgress = false;\r\n  }\r\n  /**\r\n   * Trả về danh sách hồ sơ lấy về từ server\r\n   * @type {string} default is open\r\n   * @return {Promise<void>}\r\n   */\r\n  async getAllPackages(type: string = 'open'): Promise<void> {\r\n    await this.httpClient\r\n      .get(this.syncData.detaServer.link + 'api/list-all/' + type)\r\n      .subscribe((res: Object) => {\r\n        // @ts-ignore\r\n        this.serverSyncHoSo = res.items;\r\n        console.log('getAllPackages()' + this.serverSyncHoSo);\r\n        this.serverSyncHoSo_Keys = this.serverSyncHoSo\r\n          .map((hoso) => hoso.key)\r\n          .filter((key) => key !== undefined) as string[];\r\n        /* {\r\n              \"items\": [\r\n                  {\r\n                      \"key\": \"erqjywj0j8jv\",\r\n                      \"sync\": {\r\n                          \"type\": \"open\"\r\n                      }\r\n                  },...\r\n              ],\r\n              \"count\": 3\r\n          } */\r\n      });\r\n  }\r\n  async insertHosoToServer(hoso: HOSO): Promise<HOSO> {\r\n    return new Promise((resolve, reject) => {\r\n      this.httpClient\r\n        .post(this.syncData.detaServer.link + 'api/hoso/insert', hoso)\r\n        .subscribe({\r\n          next: async (newHoSo: any) => {\r\n            await this.hosoService.addNewHoSo(\r\n              newHoSo,\r\n              CAIDAT.hoso.saveFromSyncServer\r\n            );\r\n            resolve(newHoSo);\r\n          },\r\n          error: (err: any) => reject(err),\r\n        });\r\n    });\r\n  }\r\n}\r\n","// Imports\nvar ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\");\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `section {\n  margin-top: 1em;\n  margin-bottom: 2.5em;\n}\n\nsection:not(.full-width),\n.full-width > header {\n  padding: 0 10px;\n}\n\nheader {\n  font-size: 1em;\n  font-weight: 600;\n  letter-spacing: 0.05em;\n  margin-bottom: 1.25em;\n  text-transform: uppercase;\n  border-bottom: 2px solid var(--ion-color-primary);\n}\n\na {\n  text-decoration: none;\n}\n\n.secretKeysDiv {\n  position: relative;\n}\n.secretKeysDiv ion-button {\n  position: absolute;\n  right: 0px;\n  top: 20%;\n  z-index: 1;\n  font-size: 10px;\n}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/app/cai-dat/cai-dat.page.scss\"],\"names\":[],\"mappings\":\"AAAA;EACE,eAAA;EACA,oBAAA;AACF;;AAEA;;EAEE,eAAA;AACF;;AACA;EACE,cAAA;EACE,gBAAA;EACA,sBAAA;EACA,qBAAA;EACA,yBAAA;EACA,iDAAA;AAEJ;;AAAA;EACE,qBAAA;AAGF;;AADA;EACE,kBAAA;AAIF;AAHE;EACE,kBAAA;EACA,UAAA;EACA,QAAA;EACA,UAAA;EACA,eAAA;AAKJ\",\"sourcesContent\":[\"section {\\r\\n  margin-top: 1em;\\r\\n  margin-bottom: 2.5em;\\r\\n}\\r\\n\\r\\nsection:not(.full-width),\\r\\n.full-width > header {\\r\\n  padding: 0 10px;\\r\\n}\\r\\nheader {\\r\\n  font-size: 1em;\\r\\n    font-weight: 600;\\r\\n    letter-spacing: 0.05em;\\r\\n    margin-bottom: 1.25em;\\r\\n    text-transform: uppercase;\\r\\n    border-bottom: 2px solid var(--ion-color-primary);\\r\\n}\\r\\na{\\r\\n  text-decoration: none;\\r\\n}\\r\\n.secretKeysDiv{\\r\\n  position: relative;\\r\\n  ion-button{\\r\\n    position: absolute;\\r\\n    right: 0px;\\r\\n    top: 20%;\\r\\n    z-index: 1;\\r\\n    font-size: 10px;\\r\\n  }\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nmodule.exports = ___CSS_LOADER_EXPORT___.toString();\n"],"names":["NgModule","RouterModule","CaiDatPage","routes","path","component","CaiDatPageRoutingModule","__decorate","imports","forChild","exports","CommonModule","FormsModule","IonicModule","CaiDatPageModule","declarations","Component","ToastService","ModalController","SyncService","_class","constructor","toastController","modalController","syncService","openLicense","githubtoken","init","_asyncToGenerator","change_DataSync","saveToStorage","selector","template","__NG_CLI_RESOURCE__0","Injectable","Storage","CAIDAT","HttpClient","HosoService","storage","httpClient","hosoService","syncData","detaServer","serverValid","serverValidInfo","sync","infoLoiServer","syncInProgress","_storage","serverSyncHoSo","serverSyncHoSo_Keys","_this","create","get","syncKeyStorage","then","re","isServerValid","_this2","_this2$_storage","link","presentToast","message","color","set","_this3","response","postToServer","m","infoKetNoiServer","error","console","url","payload","_this4","post","toPromise","startSync","_this5","getAllPackages","hoso","danhsachhoso","key","undefined","includes","newHoSo","insertHosoToServer","info","hosoFromServer","filter","item","length","lastSync","respd","log","hosoFromServerCoMaLocalKhong","serverHoso","some","localHoso","addNewHoSo","type","_this6","subscribe","res","items","map","_this7","Promise","resolve","reject","next","_ref","saveFromSyncServer","_x","apply","arguments","err","providedIn"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}